<div class="comments">
  <h3 class="comments__title">
    Comments:
  </h3>

  <p class="comments__help">
    Add a comment by sending an email to <a href="mailto:comments@honeyfox.uk?subject={{ $.File.TranslationBaseName | urlize }}">comments@honeyfox.uk</a>, with the subject line "{{ $.File.TranslationBaseName }}".
    You can use markdown for formatting.
  </p>

  {{ $optBlock := dict "display" "block" }}

  <!-- FIXME: calling index on a nil errors, so have to check: i hate this -->
  {{ $comments := $.Site.Data.comments | default dict }}
  {{ range index $comments $.File.TranslationBaseName }}
    <div class="comment">
      <div class="comment__author">
        <span class="comment__author-name">
          {{ if .from_name }}
            {{ .from_name }}
          {{ else }}
            anon
          {{ end }}
        </span>
        <span class="commment__author-wrote">wrote at</span>
        <span class="comment__author-date">
          <time datetime="{{ .timestamp }}">
            {{ .timestamp | time.Format $.Site.Params.dateFormat }} 
          </time>
        </span>
      </div>
      <div class="comment__body">
        {{ .body | htmlEscape | $.Page.RenderString $optBlock }}
      </div>
    </div>
  {{ else }}
    <p>No comments yet.</p> 
  {{ end }}

</div>